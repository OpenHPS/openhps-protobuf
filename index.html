<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@openhps/protobuf</title><meta name="description" content="Documentation for @openhps/protobuf"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@openhps/protobuf</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>@openhps/protobuf</h2></div><div class="tsd-panel tsd-typography"><h1 align="center">
  <img alt="OpenHPS" src="https://openhps.org/images/logo_text-512.png" width="40%" /><br />
  @openhps/protobuf
</h1>
<p align="center">
    <a href="https://github.com/OpenHPS/openhps-protobuf/actions/workflows/main.yml" target="_blank">
        <img alt="Build Status" src="https://github.com/OpenHPS/openhps-protobuf/actions/workflows/main.yml/badge.svg">
    </a>
    <a href="https://codecov.io/gh/OpenHPS/openhps-protobuf">
        <img src="https://codecov.io/gh/OpenHPS/openhps-protobuf/branch/master/graph/badge.svg?token=U896HUBDCZ"/>
    </a>
    <a href="https://codeclimate.com/github/OpenHPS/openhps-protobuf/" target="_blank">
        <img alt="Maintainability" src="https://img.shields.io/codeclimate/maintainability/OpenHPS/openhps-protobuf">
    </a>
    <a href="https://badge.fury.io/js/@openhps%2Fprotobuf">
        <img src="https://badge.fury.io/js/@openhps%2Fprotobuf.svg" alt="npm version" height="18">
    </a>
</p>

<h3 align="center">
    <a href="https://github.com/OpenHPS/openhps-core">@openhps/core</a> &mdash; <a href="https://openhps.org/docs/protobuf">API</a>
</h3>

<br />

<p>When serializing data generated by OpenHPS, the framework will use a modified serialization strategy of <a href="https://github.com/JohnWeisz/TypedJSON/">TypedJSON</a> to convert the data to JSON format. This serialized JSON data can be used for socket, MQTT and REST communication when transmitting data from client to server. In real-time situations, JSON messages might be too large to transmit from embedded devices to a server. </p>
<p><a href="https://protobuf.dev/">Protocol buffers</a> are language-neutral and platform-neutral mechanisms for serializing structured data to lightweight buffers. Instead of encoding the structure of your data within the JSON data that is being serialized, a structured <em>message type</em> is defined beforehand that can be used by the serializer and deserializer. This structured <em>message type</em> will ensure that the data adheres to a specific structure while also prevent the need to encode this structure within the serialized data, lowering the size of the serialized data drastically.</p>
<p>This OpenHPS module includes the serialization and deserialization engine for Protocol Buffer Messages to OpenHPS classes and object instances. In addition, this module provides a CLI tool for generating protocol message types of all OpenHPS modules installed in your project. Combined, these two features ensure that you do not have to manually create message types and do not manually have to create a custom deserialization strategy for each class you might need to serialize.</p>
<a id="md:features" class="tsd-anchor"></a><h2><a href="#md:features">Features</a></h2><ul>
<li>Automatic protocol buffer message type generator</li>
<li>Serialization and deserialization of all serializable OpenHPS classes</li>
</ul>
<a id="md:known-limitationsworkarounds" class="tsd-anchor"></a><h2><a href="#md:known-limitationsworkarounds">Known Limitations/Workarounds</a></h2><ul>
<li>JavaScript only uses <code>Number</code> as a primitive. Protocol buffers use integers, floats, ... OpenHPS includes the <code>NumberType</code> enum option for <code>SerializableMember</code> decorators. When no number type is specified a number will be serialized to a string to ensure compatibility.</li>
<li>Polymorphism and inheritance is not possible in protocol buffer v3. In order to ensure maintainable messages, any serializable object with known types will be treated as a <code>google.protobuf.Any</code> type with an included <code>type_url</code> that can be used for deserialization. </li>
<li>Objects that use generic types will also make use of <code>google.protobuf.Any</code>. However, generic types that include primitives will be serialized using a primitive wrapper.</li>
</ul>
<a id="md:usage" class="tsd-anchor"></a><h2><a href="#md:usage">Usage</a></h2><a id="md:cli-generator" class="tsd-anchor"></a><h3><a href="#md:cli-generator">CLI Generator</a></h3><p>This module can generate the protocol files (*.proto) automatically. </p>
<ol>
<li>Install the module using <code>npm install @openhps/protobuf@latest</code></li>
<li>Open the root directory of your project containing your <code>package.json</code> file</li>
<li>Execute the CLI command using <code>openhps-protobuf</code></li>
</ol>
<a id="md:parameters" class="tsd-anchor"></a><h4><a href="#md:parameters">Parameters</a></h4><p><code>-d &lt;directory&gt;</code>        Output directory<br><code>-v</code>                    Verbose logging</p>
<a id="md:output-data" class="tsd-anchor"></a><h4><a href="#md:output-data">Output Data</a></h4><p>The output directory will include a subdirectory for each OpenHPS package.</p>
<a id="md:serialization-and-deserialization" class="tsd-anchor"></a><h3><a href="#md:serialization-and-deserialization">Serialization and Deserialization</a></h3><p>First the protocol buffer serializer has to be initialized with the messages.</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">ProtobufSerializer</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@openhps/protobuf&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Initialize the protocol buffer serializer with the protocol files</span><br/><span class="hl-2">ProtobufSerializer</span><span class="hl-1">.</span><span class="hl-5">initialize</span><span class="hl-1">(</span><span class="hl-3">&quot;/home/openhps/protobuf/&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Or</span><br/><br/><span class="hl-4">// Initialize the protocol buffer serialization by creating protocol messages in the ./tmp directory</span><br/><span class="hl-2">ProtobufSerializer</span><span class="hl-1">.</span><span class="hl-5">initialize</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<p>An example protocol buffer message type can be seen below for a <code>DataObject</code>. The absolute and relative positions are set to an <code>Any</code> type.</p>
<pre><code class="language-proto"><span class="hl-6">package</span><span class="hl-1"> </span><span class="hl-3">openhps.core</span><span class="hl-1">;</span><br/><span class="hl-6">syntax</span><span class="hl-1"> = </span><span class="hl-3">&quot;proto3&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> </span><span class="hl-3">&quot;google/protobuf/any.proto&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">message</span><span class="hl-1"> </span><span class="hl-7">DataObject</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">string</span><span class="hl-1"> </span><span class="hl-2">displayName</span><span class="hl-1"> = </span><span class="hl-8">1</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">int64</span><span class="hl-1"> </span><span class="hl-2">createdTimestamp</span><span class="hl-1"> = </span><span class="hl-8">2</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">string</span><span class="hl-1"> </span><span class="hl-2">uid</span><span class="hl-1"> = </span><span class="hl-8">3</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">string</span><span class="hl-1"> </span><span class="hl-2">parentUID</span><span class="hl-1"> = </span><span class="hl-8">4</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">google.protobuf.Any</span><span class="hl-1"> </span><span class="hl-2">position</span><span class="hl-1"> = </span><span class="hl-8">5</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">repeated</span><span class="hl-1"> </span><span class="hl-6">google.protobuf.Any</span><span class="hl-1"> </span><span class="hl-2">relativePositions</span><span class="hl-1"> = </span><span class="hl-8">6</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<pre><code class="language-proto"><span class="hl-6">package</span><span class="hl-1"> </span><span class="hl-3">openhps.core</span><span class="hl-1">;</span><br/><span class="hl-6">syntax</span><span class="hl-1"> = </span><span class="hl-3">&quot;proto3&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> </span><span class="hl-3">&quot;Velocity.proto&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> </span><span class="hl-3">&quot;Orientation.proto&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> </span><span class="hl-3">&quot;google/protobuf/any.proto&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">message</span><span class="hl-1"> </span><span class="hl-7">Absolute3DPosition</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">string</span><span class="hl-1"> </span><span class="hl-2">timestamp</span><span class="hl-1"> = </span><span class="hl-8">1</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">Velocity</span><span class="hl-1"> </span><span class="hl-2">velocity</span><span class="hl-1"> = </span><span class="hl-8">2</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">Orientation</span><span class="hl-1"> </span><span class="hl-2">orientation</span><span class="hl-1"> = </span><span class="hl-8">3</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">google.protobuf.Any</span><span class="hl-1"> </span><span class="hl-2">unit</span><span class="hl-1"> = </span><span class="hl-8">4</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">string</span><span class="hl-1"> </span><span class="hl-2">referenceSpaceUID</span><span class="hl-1"> = </span><span class="hl-8">5</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">google.protobuf.Any</span><span class="hl-1"> </span><span class="hl-2">accuracy</span><span class="hl-1"> = </span><span class="hl-8">6</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">string</span><span class="hl-1"> </span><span class="hl-2">probability</span><span class="hl-1"> = </span><span class="hl-8">7</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">double</span><span class="hl-1"> </span><span class="hl-2">x</span><span class="hl-1"> = </span><span class="hl-8">8</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">double</span><span class="hl-1"> </span><span class="hl-2">y</span><span class="hl-1"> = </span><span class="hl-8">9</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">double</span><span class="hl-1"> </span><span class="hl-2">z</span><span class="hl-1"> = </span><span class="hl-8">10</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:openhpssocket" class="tsd-anchor"></a><h3><a href="#md:openhpssocket">@openhps/socket</a></h3><pre><code class="language-ts"><span class="hl-2">ModelBuilder</span><span class="hl-1">.</span><span class="hl-5">create</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-5">addService</span><span class="hl-1">(</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-5">SocketServer</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">srv:</span><span class="hl-1"> </span><span class="hl-2">server</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">path:</span><span class="hl-1"> </span><span class="hl-3">&quot;/api/v1&quot;</span><br/><span class="hl-1">    }))</span><br/><span class="hl-1">    .</span><span class="hl-5">from</span><span class="hl-1">(</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-5">SocketServerSource</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">uid:</span><span class="hl-1"> </span><span class="hl-3">&quot;source&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">// Override serializer and deserializer with protocol buffer</span><br/><span class="hl-1">        </span><span class="hl-5">serialize</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">obj</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">ProtobufSerializer</span><span class="hl-1">.</span><span class="hl-5">serialize</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-5">deserialize</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">obj</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">ProtobufSerializer</span><span class="hl-1">.</span><span class="hl-5">deserialize</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">)</span><br/><span class="hl-1">    }))</span><br/><span class="hl-1">    .</span><span class="hl-5">to</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-5">build</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<a id="md:openhpsmqtt" class="tsd-anchor"></a><h3><a href="#md:openhpsmqtt">@openhps/mqtt</a></h3><pre><code class="language-ts"><span class="hl-2">ModelBuilder</span><span class="hl-1">.</span><span class="hl-5">create</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-5">addService</span><span class="hl-1">(</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-5">MQTTServer</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">port:</span><span class="hl-1"> </span><span class="hl-8">1443</span><span class="hl-1">,</span><br/><span class="hl-1">    }))</span><br/><span class="hl-1">    .</span><span class="hl-5">from</span><span class="hl-1">(</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-5">MQTTSourceNode</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">uid:</span><span class="hl-1"> </span><span class="hl-3">&quot;source&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">// Override frame serializer (not the options)</span><br/><span class="hl-1">        </span><span class="hl-5">serialize</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">obj</span><span class="hl-1">, </span><span class="hl-2">options</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">            </span><span class="hl-2">frame:</span><span class="hl-1"> </span><span class="hl-2">ProtobufSerializer</span><span class="hl-1">.</span><span class="hl-5">serialize</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">),</span><br/><span class="hl-1">            </span><span class="hl-2">options</span><br/><span class="hl-1">        }),</span><br/><span class="hl-1">        </span><span class="hl-5">deserialize</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">obj</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">ProtobufSerializer</span><span class="hl-1">.</span><span class="hl-5">deserialize</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">.</span><span class="hl-2">frame</span><span class="hl-1">)</span><br/><span class="hl-1">    }))</span><br/><span class="hl-1">    .</span><span class="hl-5">to</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-5">build</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<a id="md:getting-started" class="tsd-anchor"></a><h2><a href="#md:getting-started">Getting Started</a></h2><p>If you have <a href="https://www.npmjs.com/get-npm">npm installed</a>, start using @openhps/protobuf with the following command.</p>
<pre><code class="language-bash"><span class="hl-5">npm</span><span class="hl-1"> </span><span class="hl-3">install</span><span class="hl-1"> </span><span class="hl-3">@openhps/protobuf</span><span class="hl-1"> </span><span class="hl-6">--save</span>
</code><button>Copy</button></pre>
<a id="md:contributors" class="tsd-anchor"></a><h2><a href="#md:contributors">Contributors</a></h2><p>The framework is open source and is mainly developed by PhD Student Maxim Van de Wynckel as part of his research towards <em>Hybrid Positioning and Implicit Human-Computer Interaction</em> under the supervision of Prof. Dr. Beat Signer.</p>
<a id="md:contributing" class="tsd-anchor"></a><h2><a href="#md:contributing">Contributing</a></h2><p>Use of OpenHPS, contributions and feedback is highly appreciated. Please read our <a href="CONTRIBUTING.md">contributing guidelines</a> for more information.</p>
<a id="md:license" class="tsd-anchor"></a><h2><a href="#md:license">License</a></h2><p>Copyright (C) 2019-2024 Maxim Van de Wynckel &amp; Vrije Universiteit Brussel</p>
<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="https://www.apache.org/licenses/LICENSE-2.0">https://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:features"><span>Features</span></a><a href="#md:known-limitationsworkarounds"><span>Known <wbr/>Limitations/<wbr/>Workarounds</span></a><a href="#md:usage"><span>Usage</span></a><ul><li><a href="#md:cli-generator"><span>CLI <wbr/>Generator</span></a></li><li><ul><li><a href="#md:parameters"><span>Parameters</span></a></li><li><a href="#md:output-data"><span>Output <wbr/>Data</span></a></li></ul></li><li><a href="#md:serialization-and-deserialization"><span>Serialization and <wbr/>Deserialization</span></a></li><li><a href="#md:openhpssocket"><span>@openhps/socket</span></a></li><li><a href="#md:openhpsmqtt"><span>@openhps/mqtt</span></a></li></ul><a href="#md:getting-started"><span>Getting <wbr/>Started</span></a><a href="#md:contributors"><span>Contributors</span></a><a href="#md:contributing"><span>Contributing</span></a><a href="#md:license"><span>License</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@openhps/protobuf</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer></footer><div class="overlay"></div></body></html>